---
import ThemeToggle from "../ThemeToggle.astro";
import { MENU_LINKS } from "@/data/constants";
import Logo from "@/components/Logo";

const url = new URL(Astro.request.url);
---

<script>
	import { toggleClass } from "@/utils";

	document.addEventListener("DOMContentLoaded", () => {
		const header = document.getElementById("main-header") as HTMLElement;
		const toggleMenuButton = document.getElementById("toggle-navigation-menu") as HTMLButtonElement;
		let menuOpen = false;

		toggleMenuButton.addEventListener("click", () => {
			toggleClass(header, "menu-open");
			menuOpen = !menuOpen;
			toggleMenuButton.setAttribute("aria-expanded", menuOpen.toString());
		});
	});
</script>

<header id="main-header" class="group relative mb-6 flex items-center sm:mb-16 sm:ps-[4.5rem]">
	<div class="flex flex-row">
		<div class="collapse grayscale hover:filter-none sm:visible sm:relative sm:inline-block">
			<a href="/" aria-current={url.pathname === "/" ? "page" : false}>
				<Logo />
			</a>
		</div>

		<div class="flex sm:ml-24 sm:mt-24 sm:flex-col">
			<a href="/" aria-current={url.pathname === "/" ? "page" : false}>
				<span class="text-xl font-bold sm:text-2xl">Yunzhe's Space</span>
			</a>
			<nav
				id="navigation-menu"
				class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-[--theme-menu-bg] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
				aria-label="Main menu"
			>
				{
					MENU_LINKS.map((link: any) => (
						<a
							href={link.path}
							class={`px-4 py-4 sm:py-0 sm:hover:underline ${link.icon ? "flex items-center gap-1" : ""}`}
							aria-current={url.pathname === link.path ? "page" : false}
							rel={link.external ? "noopener noreferrer" : "prefetch"}
							target={link.external ? "_blank" : undefined}
						>
							{link.icon && link.icon === "github" && (
								<svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
									<path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />
								</svg>
							)}
							{link.icon && link.icon === "linkedin" && (
								<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
									<path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path>
									<path d="M8 11l0 5"></path>
									<path d="M8 8l0 .01"></path>
									<path d="M12 16l0 -5"></path>
									<path d="M16 16v-3a2 2 0 0 0 -4 0"></path>
								</svg>
							)}
							{link.icon && link.icon === "scholar" && (
								<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
									<path d="M22 9l-10 -4l-10 4l10 4l10 -4v6"></path>
									<path d="M6 10.6v5.4a6 3 0 0 0 12 0v-5.4"></path>
								</svg>
							)}
							{link.icon && link.icon === "cv" && (
								<svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
									<path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18.5,20H5.5V4H13V9H18.5V20Z" />
								</svg>
							)}
							<span class={link.icon ? "sm:hidden" : ""}>{link.title}</span>
						</a>
					))
				}
			</nav>
		</div>
	</div>
	<ThemeToggle />
	<button
		id="toggle-navigation-menu"
		class="group relative ms-8 h-7 w-7 sm:invisible sm:hidden"
		type="button"
		aria-label="Open main menu"
		aria-expanded="false"
		aria-haspopup="menu"
	>
		<svg
			id="line-svg"
			class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
			aria-hidden="true"
			focusable="false"
			xmlns="http://www.w3.org/2000/svg"
			fill="none"
			viewBox="0 0 24 24"
			stroke-width="1.5"
			stroke="currentColor"
		>
			<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9h16.5m-16.5 6.75h16.5"></path>
		</svg>
		<svg
			id="cross-svg"
			class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
			class="text-accent"
			aria-hidden="true"
			focusable="false"
			xmlns="http://www.w3.org/2000/svg"
			fill="none"
			viewBox="0 0 24 24"
			stroke-width="1.5"
			stroke="currentColor"
		>
			<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
		</svg>
	</button>
</header>
